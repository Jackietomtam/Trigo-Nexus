# 🚀 Trigo Nexus 部署指南

将你的 AI 交易系统部署到互联网，让全世界都能访问！

---

## 📋 部署前准备

### 1. 检查必要文件
确保项目包含以下文件：
- ✅ `requirements.txt` - Python 依赖
- ✅ `Procfile` - 部署配置
- ✅ `.gitignore` - 忽略敏感文件
- ✅ `env.example` - 环境变量示例

### 2. 准备 API 密钥
你需要以下 API 密钥：
- **OpenRouter API Key** (用于 DeepSeek V3.2)
- **阿里云百炼 API Key** (用于 Qwen3 MAX)
- *(可选)* Finnhub API Key

---

## 🎯 推荐部署平台

### 方案 1: Railway ⭐⭐⭐⭐⭐ (最推荐)
**优点**: 免费额度充足，部署超简单，自动 HTTPS，速度快
**免费额度**: 每月 $5 免费额度 + 500 小时运行时间

#### 部署步骤：

**1. 创建 GitHub 仓库**
```bash
cd "/Users/sogmac/Desktop/Agent-Test/AI交易"
git init
git add .
git commit -m "Initial commit"
```

**2. 推送到 GitHub**
- 在 GitHub 创建新仓库（可以是私有仓库）
- 按照提示推送代码：
```bash
git remote add origin https://github.com/你的用户名/trigo-nexus.git
git branch -M main
git push -u origin main
```

**3. 部署到 Railway**
1. 访问 [railway.app](https://railway.app)
2. 使用 GitHub 账号登录
3. 点击 **"New Project"**
4. 选择 **"Deploy from GitHub repo"**
5. 选择你刚创建的仓库
6. Railway 会自动检测并部署

**4. 配置环境变量**
在 Railway 项目设置中添加：
```
OPENROUTER_API_KEY=sk-or-v1-你的密钥
DASHSCOPE_API_KEY=sk-你的密钥
FINNHUB_API_KEY=你的密钥
PORT=5001
```

**5. 访问你的网站**
- Railway 会自动生成一个域名，如：`trigo-nexus.railway.app`
- 你也可以绑定自己的域名

---

### 方案 2: Render ⭐⭐⭐⭐
**优点**: 完全免费，无需信用卡，自动 HTTPS
**免费额度**: 750 小时/月，15 分钟无活动会休眠

#### 部署步骤：

**1. 同样需要 GitHub 仓库**
（参考方案 1 的第 1-2 步）

**2. 部署到 Render**
1. 访问 [render.com](https://render.com)
2. 使用 GitHub 登录
3. 点击 **"New +"** → **"Web Service"**
4. 连接你的 GitHub 仓库
5. 填写配置：
   - **Name**: trigo-nexus
   - **Environment**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn --worker-class eventlet -w 1 app_v2:app --bind 0.0.0.0:$PORT`

**3. 配置环境变量**
在 "Environment" 标签添加：
```
OPENROUTER_API_KEY=sk-or-v1-你的密钥
DASHSCOPE_API_KEY=sk-你的密钥
FINNHUB_API_KEY=你的密钥
```

**4. 部署完成**
- Render 会给你一个域名，如：`trigo-nexus.onrender.com`
- 首次访问可能需要等待 30 秒（从休眠唤醒）

---

### 方案 3: Heroku ⭐⭐⭐
**优点**: 老牌稳定，文档丰富
**缺点**: 需要信用卡验证（即使使用免费套餐）

#### 部署步骤：

**1. 安装 Heroku CLI**
```bash
brew install heroku/brew/heroku
```

**2. 登录并创建应用**
```bash
cd "/Users/sogmac/Desktop/Agent-Test/AI交易"
heroku login
heroku create trigo-nexus
```

**3. 配置环境变量**
```bash
heroku config:set OPENROUTER_API_KEY=sk-or-v1-你的密钥
heroku config:set DASHSCOPE_API_KEY=sk-你的密钥
heroku config:set FINNHUB_API_KEY=你的密钥
```

**4. 部署**
```bash
git push heroku main
```

**5. 打开应用**
```bash
heroku open
```

---

### 方案 4: 自己的 VPS (高级用户) ⭐⭐⭐⭐⭐
**优点**: 完全控制，性能最好，无限制
**适合**: 有服务器经验的用户

#### 推荐服务商：
- **Vultr**: $5/月起
- **DigitalOcean**: $4/月起
- **阿里云**: 学生机 9.9 元/月

#### 部署步骤（Ubuntu 服务器）：

**1. 连接服务器**
```bash
ssh root@你的服务器IP
```

**2. 安装依赖**
```bash
apt update
apt install -y python3 python3-pip git nginx
```

**3. 克隆代码**
```bash
cd /opt
git clone https://github.com/你的用户名/trigo-nexus.git
cd trigo-nexus
pip3 install -r requirements.txt
```

**4. 配置环境变量**
```bash
nano .env
```
添加：
```
OPENROUTER_API_KEY=sk-or-v1-你的密钥
DASHSCOPE_API_KEY=sk-你的密钥
FINNHUB_API_KEY=你的密钥
```

**5. 使用 Systemd 管理服务**
创建 `/etc/systemd/system/trigo-nexus.service`：
```ini
[Unit]
Description=Trigo Nexus AI Trading
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/trigo-nexus
Environment="PATH=/usr/bin"
ExecStart=/usr/bin/python3 app_v2.py
Restart=always

[Install]
WantedBy=multi-user.target
```

启动服务：
```bash
systemctl daemon-reload
systemctl start trigo-nexus
systemctl enable trigo-nexus
```

**6. 配置 Nginx 反向代理**
创建 `/etc/nginx/sites-available/trigo-nexus`：
```nginx
server {
    listen 80;
    server_name 你的域名.com;

    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /socket.io {
        proxy_pass http://127.0.0.1:5001/socket.io;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

启用站点：
```bash
ln -s /etc/nginx/sites-available/trigo-nexus /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx
```

**7. 配置 HTTPS (Let's Encrypt)**
```bash
apt install -y certbot python3-certbot-nginx
certbot --nginx -d 你的域名.com
```

---

## 🔒 安全建议

### 1. 保护 API 密钥
- ✅ **永远不要**把 API 密钥直接提交到 GitHub
- ✅ 使用环境变量存储敏感信息
- ✅ `.gitignore` 已配置忽略 `.env` 文件

### 2. 如果不小心泄露了密钥
1. **立即**在对应平台重新生成新密钥
2. 删除 Git 历史中的敏感信息：
```bash
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch config.py" \
  --prune-empty --tag-name-filter cat -- --all
```

### 3. 添加访问限制（可选）
如果不想公开访问，可以添加简单的密码保护。

---

## 📊 部署后检查清单

- [ ] 网站可以正常访问
- [ ] AI 模型卡片显示正常
- [ ] 价格数据实时更新
- [ ] 图表正常渲染
- [ ] AI 可以正常进行交易决策
- [ ] WebSocket 连接正常（查看浏览器控制台）
- [ ] 没有 API 密钥报错

---

## 🐛 常见问题

### 问题 1: 部署后网站打不开
**解决方案**:
1. 检查日志（Railway/Render 都有日志功能）
2. 确认端口配置正确（使用 `$PORT` 环境变量）
3. 确认 `host='0.0.0.0'` 而不是 `127.0.0.1`

### 问题 2: AI 不工作，显示 API 错误
**解决方案**:
1. 检查环境变量是否正确配置
2. 确认 API 密钥有效
3. 查看服务器日志

### 问题 3: WebSocket 连接失败
**解决方案**:
1. 确保使用 `eventlet` worker: `gunicorn --worker-class eventlet`
2. 检查 Nginx 配置（如果使用 VPS）
3. 确认平台支持 WebSocket（Railway 和 Render 都支持）

### 问题 4: 部署后性能差
**解决方案**:
1. Railway/Render 免费版性能有限，考虑升级
2. 优化数据库查询（如果使用数据库）
3. 考虑使用 VPS

---

## 💰 成本对比

| 平台 | 免费额度 | 付费价格 | 推荐指数 |
|------|---------|---------|---------|
| **Railway** | $5/月 + 500小时 | $5 起步 | ⭐⭐⭐⭐⭐ |
| **Render** | 750小时/月 | $7/月起 | ⭐⭐⭐⭐ |
| **Heroku** | 需信用卡 | $7/月起 | ⭐⭐⭐ |
| **Vultr VPS** | 无 | $5/月起 | ⭐⭐⭐⭐⭐ |

---

## 🌐 绑定自定义域名

### Railway / Render
1. 在平台设置中添加自定义域名
2. 在域名服务商添加 CNAME 记录：
   ```
   CNAME  @  你的应用域名
   ```

### Heroku
```bash
heroku domains:add www.你的域名.com
```

### VPS
直接在 Nginx 配置中修改 `server_name`

---

## 📞 需要帮助？

如果遇到问题：
1. 查看平台官方文档
2. 检查服务器日志
3. 在 GitHub 提 Issue

---

**祝部署顺利！🎉**

你的 AI 交易系统即将上线，向全世界展示你的成果！

